@model NationalNeon.Domain.User.UserModel
<style>
    .has-error {
        color: red;
        display: none;
    }
</style>
<div id="content" style="opacity: 1;">
    <section id="widget-grid" class="">

        <!-- row -->
        <div class="row">

            <!-- NEW WIDGET START -->
            <article class="col-md-2 actions sortable-grid ui-sortable">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget jarviswidget-sortable" id="wid-id-0" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" role="widget">
                    <header role="heading">
                        <div class="widget-toolbar" role="menu"><a data-toggle="dropdown" class="dropdown-toggle color-box selector" href="javascript:void(0);"></a><ul class="dropdown-menu arrow-box-up-right color-select pull-right"><li><span class="bg-color-green" data-widget-setstyle="jarviswidget-color-green" rel="tooltip" data-placement="left" data-original-title="Green Grass"></span></li><li><span class="bg-color-greenDark" data-widget-setstyle="jarviswidget-color-greenDark" rel="tooltip" data-placement="top" data-original-title="Dark Green"></span></li><li><span class="bg-color-greenLight" data-widget-setstyle="jarviswidget-color-greenLight" rel="tooltip" data-placement="top" data-original-title="Light Green"></span></li><li><span class="bg-color-purple" data-widget-setstyle="jarviswidget-color-purple" rel="tooltip" data-placement="top" data-original-title="Purple"></span></li><li><span class="bg-color-magenta" data-widget-setstyle="jarviswidget-color-magenta" rel="tooltip" data-placement="top" data-original-title="Magenta"></span></li><li><span class="bg-color-pink" data-widget-setstyle="jarviswidget-color-pink" rel="tooltip" data-placement="right" data-original-title="Pink"></span></li><li><span class="bg-color-pinkDark" data-widget-setstyle="jarviswidget-color-pinkDark" rel="tooltip" data-placement="left" data-original-title="Fade Pink"></span></li><li><span class="bg-color-blueLight" data-widget-setstyle="jarviswidget-color-blueLight" rel="tooltip" data-placement="top" data-original-title="Light Blue"></span></li><li><span class="bg-color-teal" data-widget-setstyle="jarviswidget-color-teal" rel="tooltip" data-placement="top" data-original-title="Teal"></span></li><li><span class="bg-color-blue" data-widget-setstyle="jarviswidget-color-blue" rel="tooltip" data-placement="top" data-original-title="Ocean Blue"></span></li><li><span class="bg-color-blueDark" data-widget-setstyle="jarviswidget-color-blueDark" rel="tooltip" data-placement="top" data-original-title="Night Sky"></span></li><li><span class="bg-color-darken" data-widget-setstyle="jarviswidget-color-darken" rel="tooltip" data-placement="right" data-original-title="Night"></span></li><li><span class="bg-color-yellow" data-widget-setstyle="jarviswidget-color-yellow" rel="tooltip" data-placement="left" data-original-title="Day Light"></span></li><li><span class="bg-color-orange" data-widget-setstyle="jarviswidget-color-orange" rel="tooltip" data-placement="bottom" data-original-title="Orange"></span></li><li><span class="bg-color-orangeDark" data-widget-setstyle="jarviswidget-color-orangeDark" rel="tooltip" data-placement="bottom" data-original-title="Dark Orange"></span></li><li><span class="bg-color-red" data-widget-setstyle="jarviswidget-color-red" rel="tooltip" data-placement="bottom" data-original-title="Red Rose"></span></li><li><span class="bg-color-redLight" data-widget-setstyle="jarviswidget-color-redLight" rel="tooltip" data-placement="bottom" data-original-title="Light Red"></span></li><li><span class="bg-color-white" data-widget-setstyle="jarviswidget-color-white" rel="tooltip" data-placement="right" data-original-title="Purity"></span></li><li><a href="javascript:void(0);" class="jarviswidget-remove-colors" data-widget-setstyle="" rel="tooltip" data-placement="bottom" data-original-title="Reset widget color to default">Remove</a></li></ul></div>
                        <span class="widget-icon"> <i class="fa fa-flash"></i> </span>
                        <h2>Actions </h2>

                        <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
                    </header>

                    <!-- widget div-->
                    <div role="content">

                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->
                            <input class="form-control" type="text">
                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">
                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#myModal">
                                Edit User
                            </button><br><br>
                            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#changepassword">
                                Change Password
                            </button><br><br>
                            @*@Html.ActionLink("Delete User", "Delete", "Users", new { id = Model.userId }, new { @class = "btn btn-danger", @id = "delete_user" })*@
                            <button type="button" data-toggle="modal" class="btn btn-danger" data-target="#opener" onclick="setUserID(@Model.userId)">Delete User</button>
                            <!-- this is what the user will see -->

                        </div>
                        <!-- end widget content -->

                    </div>
                    <!-- end widget div -->

                </div>
                <!-- end widget -->

            </article>
            <!-- WIDGET END -->
            <article class="col-md-10 users-summary sortable-grid ui-sortable">

                <!-- Widget ID (each widget will need unique ID)-->
                <div class="jarviswidget jarviswidget-sortable" id="wid-id-1" data-widget-editbutton="false" data-widget-deletebutton="false" role="widget">
                    <header role="heading">
                        <div class="jarviswidget-ctrls" role="menu">
                            <a href="javascript:void(0);" class="button-icon jarviswidget-toggle-btn" rel="tooltip" title="" data-placement="bottom" data-original-title="Collapse"><i class="fa fa-minus "></i></a>
                            <a href="javascript:void(0);" class="button-icon jarviswidget-fullscreen-btn" rel="tooltip" title="" data-placement="bottom" data-original-title="Fullscreen"><i class="fa fa-expand "></i></a>
                        </div>
                        <div class="widget-toolbar" role="menu">
                            <a data-toggle="dropdown" class="dropdown-toggle color-box selector" href="javascript:void(0);"></a>
                            <ul class="dropdown-menu arrow-box-up-right color-select pull-right">
                                <li><span class="bg-color-green" data-widget-setstyle="jarviswidget-color-green" rel="tooltip" data-placement="left" data-original-title="Green Grass"></span></li>
                                <li><span class="bg-color-greenDark" data-widget-setstyle="jarviswidget-color-greenDark" rel="tooltip" data-placement="top" data-original-title="Dark Green"></span></li>
                                <li><span class="bg-color-greenLight" data-widget-setstyle="jarviswidget-color-greenLight" rel="tooltip" data-placement="top" data-original-title="Light Green"></span></li>
                                <li><span class="bg-color-purple" data-widget-setstyle="jarviswidget-color-purple" rel="tooltip" data-placement="top" data-original-title="Purple"></span></li>
                                <li><span class="bg-color-magenta" data-widget-setstyle="jarviswidget-color-magenta" rel="tooltip" data-placement="top" data-original-title="Magenta"></span></li>
                                <li><span class="bg-color-pink" data-widget-setstyle="jarviswidget-color-pink" rel="tooltip" data-placement="right" data-original-title="Pink"></span></li>
                                <li><span class="bg-color-pinkDark" data-widget-setstyle="jarviswidget-color-pinkDark" rel="tooltip" data-placement="left" data-original-title="Fade Pink"></span></li>
                                <li><span class="bg-color-blueLight" data-widget-setstyle="jarviswidget-color-blueLight" rel="tooltip" data-placement="top" data-original-title="Light Blue"></span></li>
                                <li><span class="bg-color-teal" data-widget-setstyle="jarviswidget-color-teal" rel="tooltip" data-placement="top" data-original-title="Teal"></span></li>
                                <li><span class="bg-color-blue" data-widget-setstyle="jarviswidget-color-blue" rel="tooltip" data-placement="top" data-original-title="Ocean Blue"></span></li>
                                <li><span class="bg-color-blueDark" data-widget-setstyle="jarviswidget-color-blueDark" rel="tooltip" data-placement="top" data-original-title="Night Sky"></span></li>
                                <li><span class="bg-color-darken" data-widget-setstyle="jarviswidget-color-darken" rel="tooltip" data-placement="right" data-original-title="Night"></span></li>
                                <li><span class="bg-color-yellow" data-widget-setstyle="jarviswidget-color-yellow" rel="tooltip" data-placement="left" data-original-title="Day Light"></span></li>
                                <li><span class="bg-color-orange" data-widget-setstyle="jarviswidget-color-orange" rel="tooltip" data-placement="bottom" data-original-title="Orange"></span></li>
                                <li><span class="bg-color-orangeDark" data-widget-setstyle="jarviswidget-color-orangeDark" rel="tooltip" data-placement="bottom" data-original-title="Dark Orange"></span></li>
                                <li><span class="bg-color-red" data-widget-setstyle="jarviswidget-color-red" rel="tooltip" data-placement="bottom" data-original-title="Red Rose"></span></li>
                                <li><span class="bg-color-redLight" data-widget-setstyle="jarviswidget-color-redLight" rel="tooltip" data-placement="bottom" data-original-title="Light Red"></span></li>
                                <li><span class="bg-color-white" data-widget-setstyle="jarviswidget-color-white" rel="tooltip" data-placement="right" data-original-title="Purity"></span></li>
                                <li><a href="javascript:void(0);" class="jarviswidget-remove-colors" data-widget-setstyle="" rel="tooltip" data-placement="bottom" data-original-title="Reset widget color to default">Remove</a></li>
                            </ul>
                        </div>
                        <span class="widget-icon"> <i class="fa fa-user"></i> </span>
                        <h2>User </h2>

                        <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
                    </header>

                    <!-- widget div-->
                    <div role="content">

                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->
                            <input class="form-control" type="text">
                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">
                            <dl>

                                <dt>Username</dt>
                                <dd>
                                    @Model.username &nbsp;
                                </dd>
                                <br>
                                <dt>Role</dt>
                                <dd>
                                    @Model.role &nbsp;
                                </dd>
                                <br>
                                <dt>Created</dt>
                                <dd>
                                    @Model.created_on.ToString("yyyy-MM-dd hh:mm:ss")  &nbsp;
                                </dd>
                                <br>
                                <dt>Modified</dt>
                                <dd>
                                    @Model.updated_on.ToString("yyyy-MM-dd hh:mm:ss") &nbsp;
                                </dd>
                                <br>
                            </dl>

                            <!-- this is what the user will see -->

                        </div>
                        <!-- end widget content -->

                    </div>
                    <!-- end widget div -->

                </div>
                <!-- end widget -->

            </article>
        </div>

        <!-- end row for edit user-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header modal-popup-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h1 class="modal-title">New User</h1>
                    </div>
                    <div class="modal-body" id="editNewUser">
                        <form asp-action="Edit" asp-controller="Users" data-ajax="true" data-ajax-method="POST" id="editNewUserForm">
                            <div class="form-group">
                                <label class="control-label">User Name</label>
                                <input asp-for="username" class="form-control" required onchange="$(this).parent().find('.has-error').hide();" />
                                <span class="has-error" id="invalid_username">Please enter user name</span>
                            </div>

                            <input type="hidden" asp-for="userId" />
                            <div class="form-group">
                                <label class="control-label">Role</label>
                                @Html.DropDownListFor(x => x.role, new[]{
                                            new SelectListItem(){ Text = "Admin" , Value = "Admin"},
                                            new SelectListItem(){ Text = "Manager", Value = "Manager"},
                                            }, "---Please Select Role---", new {
                                                @class = "form-control",
                                                @onchange = "dropdown(this)"
                                            }),
                                <span class="has-error" id="invalid_role">Please Select Role</span>
                            </div>

                            <footer class="text-center form-submit">
                                <button type="button" class="btn btn-danger form-submit-btn  edit_newUser_btn">Submit</button>
                            </footer>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- row -->
        <!-- end row for change password-->
        <div class="modal fade" id="changepassword" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header modal-popup-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h1 class="modal-title">Change Password</h1>
                    </div>
                    <div class="modal-body">
                        <form data-ajax="true" data-ajax-method="POST" id="changePasswordForm">
                            <div class="form-group">
                                <label class="control-label">Password</label>
                                <input type="password" name="password" id="id1" class="form-control" required autocomplete="off" onchange="$(this).parent().find('.has-error').hide();" />
                                <span class="has-error" id="invalid_password">Please enter Password</span>
                            </div>

                            <input type="hidden" passwordUserID="@Model.userId" id="passwordUserID" />
                            <div class="form-group">
                                <label class="control-label">Re Type Password</label>
                                <input type="password" name="confirmPassword" id="id2" class="form-control" required autocomplete="off" onchange="$(this).parent().find('.has-error').hide();" />
                                <span class="has-error" id="invalid_retypepassword">Please Enter Re Type Password</span>
                            </div>

                            <footer class="text-center form-submit">
                                <input type="button" onclick="changepasswords()" class="btn btn-danger" value="Submit">
                            </footer>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- row -->


        <div class="modal fade" id="opener" role="dialog">
            <div class="modal-dialog" style="width: 320px;">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header modal-popup-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h1 class="modal-title">Do You Want To Delete ?</h1>
                    </div>
                    <div class="modal-body text-center">
                        <h5 style="color:brown">Are you sure you want to delete user :  @Model.username</h5>
                        <button onclick="deleteUsers()" class="btn btn-danger form-submit-btn" style="background:#3276b1; border-color:#3276b1">Yes</button>
                        <button data-dismiss="modal" class="btn btn-danger form-submit-btn">No</button>
                    </div>
                    @*<div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>*@
                </div>

            </div>
        </div>


    </section>
    <!-- end widget grid -->
    @*<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>*@
    <script type="text/javascript">
        var userId = 0;
        $(document).ready(function () {
            $('#opener').click(function () {
                userId = $(this).attr('userId');
                // $('#wrapper').dialog('open');
            });
        });

        function setUserID(_userId) {
            userId = _userId;
        }

        function changepasswords() {
            let isValid = true;
            var form = $('#changePasswordForm').serialize();
            if (form !== undefined) {
                if ($('input[name="password"]').val() == '' || $('input[name="password"]').val() == undefined) {
                    $("#invalid_password").show();
                    isValid = false;
                }
                if ($('input[name="confirmPassword"]').val() == '' || $('input[name="confirmPassword"]').val() == undefined) {
                    $("#invalid_retypepassword").show();
                    isValid = false;
                }
                if ($('input[name="password"]').val() != $('input[name="confirmPassword"]').val() && isValid === true) {
                    alert("Password Not Match ! Please enter Correct Password")
                    isValid = false;
                }
            }
            if (isValid) {
                const data = {
                    password: $('input[name="password"]').val(),
                    userId: $('#passwordUserID').attr('passwordUserID'),
                }
                $('#divAddPopup [id^="invalid_"]').hide();
                changepassword(data);
            }
        }

        function changepassword(form) {
            $.ajax({
                url: '/Users/ChangePassword',
                type: 'POST',
                async: false,
                data: form,
                success: function (result) {
                    if (result.success) {
                        $('.close').click();
                        $.notify({
                            title: result.title,
                            message: result.message,
                        },
                            {
                                type: result.type,
                                allow_dismiss: false,
                                showProgressbar: true,
                                delay: '100',
                                newest_on_top: true,
                            });
                    }
                    setTimeout(() => {
                        window.location.reload();
                        window.location.href = "/Users";
                    }, 2000);
                }
            });
        }


        function deleteUsers() {
            callDelete(userId);
        }

        function callDelete(userId) {
            $.ajax({
                type: 'POST',
                url: '/Users/Delete?id=' + userId + '',
                success: function (result) {
                    if (result.success) {
                        $('.close').click();
                        $.notify({
                            title: result.title,
                            message: result.message,
                        },
                            {
                                type: result.type,
                                allow_dismiss: false,
                                showProgressbar: true,
                                delay: '100',
                                newest_on_top: true,
                            });
                    }
                    setTimeout(() => {
                        window.location.reload();
                        window.location.href = "/Users";
                    }, 2000);
                }
            })
        }

        //$("#editNewUser").delegate('.edit_newUser_btn', 'click', function () {
        $(".edit_newUser_btn").click(function () {
            let isValid = true;
            var form = $('#editNewUserForm').serialize();
            if (form !== undefined) {
                if ($('input[name="username"]').val() == '' || $('input[name="username"]').val() == undefined) {
                    $("#invalid_username").show();
                    isValid = false;
                    return;
                }
                if ($('select[name="role"]').val() == '' || $('select[name="role"]').val() == undefined) {
                    $("#invalid_role").show();
                    isValid = false;
                    return;
                }
            }
            if (isValid) {
                $('#divAddPopup [id^="invalid_"]').hide();
                editUsers(form);
            }

        });

        function editUsers(form) {
            $.ajax({
                url: '/Users/Edit?id=' + userId + '',
                type: "POST",
                async: false,
                data: form,
                success: function (result) {
                    if (result.success) {
                        $('.close').click();
                        $.notify({
                            title: result.title,
                            message: result.message,
                        },
                            {
                                type: result.type,
                                allow_dismiss: false,
                                showProgressbar: true,
                                delay: '100',
                                newest_on_top: true,
                            });
                    }
                    setTimeout(() => {
                        window.location.reload();
                        window.location.href = "/Users";
                    }, 2000);
                }
            });
        }

        function dropdown(obj) {
            if (obj.parentNode.children[2] != undefined) {
                obj.parentNode.children[2].remove();
            }
        }
    </script>

</div>